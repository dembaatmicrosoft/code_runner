# =============================================================================
# Azure Deployment Workflow (Example)
# =============================================================================
#
# This is an EXAMPLE workflow for automated deployment to Azure.
# To enable it:
#   1. Rename this file to azure-deploy.yml
#   2. Configure the required secrets in your GitHub repository
#   3. Push to the main branch to trigger deployment
#
# Required Secrets:
#   - AZURE_CREDENTIALS: Azure service principal credentials (JSON)
#   - AZURE_SUBSCRIPTION_ID: Your Azure subscription ID
#   - AZURE_ENV_NAME: Environment name (e.g., 'prod', 'dev')
#   - AZURE_LOCATION: Azure region (e.g., 'eastus', 'westeurope')
#
# To create AZURE_CREDENTIALS:
#   az ad sp create-for-rbac --name "github-actions" --role contributor \
#     --scopes /subscriptions/{subscription-id} --json-auth
#
# =============================================================================

name: Deploy to Azure

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  id-token: write
  contents: read

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Install Azure Developer CLI
        uses: Azure/setup-azd@v2

      - name: Log in to Azure
        uses: azure/login@v2
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      - name: Set up azd environment
        run: |
          azd env new ${{ secrets.AZURE_ENV_NAME }} --location ${{ secrets.AZURE_LOCATION }} --subscription ${{ secrets.AZURE_SUBSCRIPTION_ID }}

      - name: Provision and Deploy
        run: azd up --no-prompt
        env:
          AZURE_ENV_NAME: ${{ secrets.AZURE_ENV_NAME }}
          AZURE_LOCATION: ${{ secrets.AZURE_LOCATION }}
          AZURE_SUBSCRIPTION_ID: ${{ secrets.AZURE_SUBSCRIPTION_ID }}
