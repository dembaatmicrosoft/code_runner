{
  "swagger": "2.0",
  "info": {
    "title": "CodeRunner API",
    "description": "Single endpoint to run Python scripts in a sandboxed subprocess.\n\nSupports two modes:\n- JSON mode: POST application/json with { script, timeout_s, context }.\n- Raw mode: POST text/plain (body = script), with timeout_s query-param (no context support).\n\nContext & Artifacts:\n- Scripts can read input files from ./input/ directory (provided via 'context')\n- Scripts can write output files to ./output/ directory (returned as 'artifacts')\n- Binary files use base64 encoding (auto-detected)\n\nLimits:\n- script: 256 KiB (UTF-8 bytes)\n- timeout_s: 300 s max (clamped)\n- context: 10 MB total, 5 MB per file, 20 files max\n- artifacts: 10 MB total\n- OOM kills at ~1.5 GB\n\nRuns inside Function host sandbox, not fully container-isolated. Suitable for development/testing; do not use with untrusted code in production.",
    "version": "2.0.0",
    "contact": {
      "name": "Developer Support",
      "url": "https://github.com/dembaatmicrosoft/code_runner/issues"
    },
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "host": "coderunner-fn.azurewebsites.net",
  "basePath": "/api",
  "schemes": [
    "https"
  ],
  "consumes": [
    "application/json",
    "text/plain"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/run": {
      "post": {
        "summary": "Execute a Python script",
        "description": "Runs the provided Python code and returns exit_code, stdout, stderr, and artifacts.\n\nTwo content-type modes supported:\n1) JSON mode (Content-Type: application/json): Send JSON object with 'script', optional 'timeout_s', and optional 'context'\n2) Raw mode (Content-Type: text/plain): Send raw script as body text; 'timeout_s' via query parameter (no context support)\n\nContext files are written to ./input/ before execution. Output files written to ./output/ are returned as artifacts.",
        "operationId": "runPythonScript",
        "parameters": [
          {
            "name": "timeout_s",
            "in": "query",
            "description": "Max seconds to allow script to run. Must be >0; values >300 are clamped to 300. Used when Content-Type is text/plain, or as fallback when not specified in JSON body.",
            "required": false,
            "type": "integer",
            "format": "int32",
            "default": 60
          },
          {
            "name": "body",
            "in": "body",
            "description": "Request body. For application/json: JSON object with script, optional timeout_s, and optional context. For text/plain: raw Python script text.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RunRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Script execution result",
            "schema": {
              "$ref": "#/definitions/RunResponse"
            },
            "examples": {
              "application/json": {
                "exit_code": 0,
                "stdout": "Hello, world!\n",
                "stderr": "",
                "artifacts": {}
              }
            }
          },
          "400": {
            "description": "Bad Request - invalid JSON, missing fields, invalid context filename, or invalid base64 encoding",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Invalid context filename: '../secret.txt'"
              }
            }
          },
          "413": {
            "description": "Payload Too Large - script > 256 KiB, context file > 5 MB, or total context > 10 MB",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Context file 'data.csv' too large: 6000000 > 5242880 bytes."
              }
            }
          },
          "500": {
            "description": "Internal Server Error - includes artifacts too large (> 10 MB)",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Total artifacts too large: exceeds 10485760 bytes."
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "RunRequest": {
      "type": "object",
      "description": "Request body for executing Python code.",
      "required": ["script"],
      "properties": {
        "script": {
          "type": "string",
          "description": "The Python code to execute (max 256 KiB UTF-8)."
        },
        "timeout_s": {
          "type": "integer",
          "format": "int32",
          "description": "Max seconds to allow script to run. Default: 60, max: 300.",
          "default": 60
        },
        "context": {
          "type": "object",
          "description": "Input files to provide to the script. Keys are filenames, values are file contents. Files are written to ./input/ before execution.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string",
                "description": "UTF-8 text content"
              },
              {
                "$ref": "#/definitions/ContextFile"
              }
            ]
          }
        }
      }
    },
    "ContextFile": {
      "type": "object",
      "description": "A context file with explicit encoding.",
      "required": ["content", "encoding"],
      "properties": {
        "content": {
          "type": "string",
          "description": "File content (text or base64-encoded binary)"
        },
        "encoding": {
          "type": "string",
          "enum": ["utf-8", "base64"],
          "description": "Content encoding: 'utf-8' for text, 'base64' for binary"
        }
      }
    },
    "RunResponse": {
      "type": "object",
      "required": ["exit_code", "stdout", "stderr", "artifacts"],
      "properties": {
        "exit_code": {
          "type": "integer",
          "format": "int32",
          "description": "Subprocess exit code: 0=success; 124=timeout; 137=OOM; -1=internal error."
        },
        "stdout": {
          "type": "string",
          "description": "Captured standard output."
        },
        "stderr": {
          "type": "string",
          "description": "Captured standard error (and any timeout/internal-error notes)."
        },
        "artifacts": {
          "type": "object",
          "description": "Output files produced by the script. Keys are filenames, values are file contents. Files are read from ./output/ after execution.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string",
                "description": "UTF-8 text content (auto-detected)"
              },
              {
                "$ref": "#/definitions/ArtifactFile"
              }
            ]
          }
        }
      }
    },
    "ArtifactFile": {
      "type": "object",
      "description": "A binary artifact file with base64 encoding.",
      "required": ["content", "encoding"],
      "properties": {
        "content": {
          "type": "string",
          "description": "Base64-encoded binary content"
        },
        "encoding": {
          "type": "string",
          "enum": ["base64"],
          "description": "Always 'base64' for binary files"
        }
      }
    },
    "ErrorResponse": {
      "type": "object",
      "required": ["error"],
      "properties": {
        "error": {
          "type": "string",
          "description": "Human-readable error message."
        }
      }
    }
  }
}
