{
  "swagger": "2.0",
  "info": {
    "title": "CodeRunner API",
    "description": "Execute Python scripts in a sandboxed subprocess.\n\nSupports three modes:\n- Script mode: POST application/json with { script, timeout_s, context }\n- Files mode: POST application/json with { files, entry_point, timeout_s, dependencies }\n- Raw mode: POST text/plain (body = script), with timeout_s query-param\n\nScript mode (legacy):\n- Scripts read input files from ./input/ (provided via 'context')\n- Scripts write output files to ./output/ (returned as 'artifacts')\n\nFiles mode (multi-file projects):\n- All files placed at execution root (natural paths)\n- Imports between files work normally\n- Entry point must be a .py file\n- Cannot mix with script/context\n\nLimits:\n- script: 256 KiB\n- timeout_s: 300 s max\n- files/context: 10 MB total, 5 MB per file, 20 files max\n- artifacts: 10 MB total\n\nIntended for trusted environments only. See SECURITY.md for details.",
    "version": "2.1.0",
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "host": "localhost:7071",
  "basePath": "/api",
  "schemes": [
    "https"
  ],
  "consumes": [
    "application/json",
    "text/plain"
  ],
  "produces": [
    "application/json"
  ],
  "paths": {
    "/run": {
      "post": {
        "summary": "Execute a Python script",
        "description": "Runs the provided Python code and returns exit_code, stdout, stderr, and artifacts.\n\nTwo content-type modes supported:\n1) JSON mode (Content-Type: application/json): Send JSON object with 'script', optional 'timeout_s', and optional 'context'\n2) Raw mode (Content-Type: text/plain): Send raw script as body text; 'timeout_s' via query parameter (no context support)\n\nContext files are written to ./input/ before execution. Output files written to ./output/ are returned as artifacts.",
        "operationId": "runPythonScript",
        "parameters": [
          {
            "name": "timeout_s",
            "in": "query",
            "description": "Max seconds to allow script to run. Must be >0; values >300 are clamped to 300. Used when Content-Type is text/plain, or as fallback when not specified in JSON body.",
            "required": false,
            "type": "integer",
            "format": "int32",
            "default": 60
          },
          {
            "name": "body",
            "in": "body",
            "description": "Request body. For application/json: JSON object with script, optional timeout_s, and optional context. For text/plain: raw Python script text.",
            "required": true,
            "schema": {
              "$ref": "#/definitions/RunRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Script execution result",
            "schema": {
              "$ref": "#/definitions/RunResponse"
            },
            "examples": {
              "application/json": {
                "exit_code": 0,
                "stdout": "Hello, world!\n",
                "stderr": "",
                "artifacts": {}
              }
            }
          },
          "400": {
            "description": "Bad Request - invalid JSON, missing fields, invalid context filename, or invalid base64 encoding",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Invalid context filename: '../secret.txt'"
              }
            }
          },
          "413": {
            "description": "Payload Too Large - script > 256 KiB, context file > 5 MB, or total context > 10 MB",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Context file 'data.csv' too large: 6000000 > 5242880 bytes."
              }
            }
          },
          "500": {
            "description": "Internal Server Error - includes artifacts too large (> 10 MB)",
            "schema": {
              "$ref": "#/definitions/ErrorResponse"
            },
            "examples": {
              "application/json": {
                "error": "Total artifacts too large: exceeds 10485760 bytes."
              }
            }
          }
        }
      }
    }
  },
  "definitions": {
    "RunRequest": {
      "type": "object",
      "description": "Request body for executing Python code. Supports two mutually exclusive modes:\n\n1. Script mode: Use 'script' with optional 'context'\n2. Files mode: Use 'files' with required 'entry_point'\n\nCannot mix modes (files + script is invalid).",
      "properties": {
        "script": {
          "type": "string",
          "description": "The Python code to execute (max 256 KiB UTF-8). Use for script mode. Mutually exclusive with 'files'."
        },
        "files": {
          "type": "object",
          "description": "All files for the project. Keys are file paths (supports nested: 'config/settings.json'), values are file contents. Files placed at execution root. Use for files mode. Mutually exclusive with 'script' and 'context'.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string",
                "description": "UTF-8 text content"
              },
              {
                "$ref": "#/definitions/ContextFile"
              }
            ]
          }
        },
        "entry_point": {
          "type": "string",
          "description": "Path to the .py file to execute (e.g., 'main.py', 'src/app.py'). Required when using 'files' mode."
        },
        "timeout_s": {
          "type": "integer",
          "format": "int32",
          "description": "Max seconds to allow script to run. Default: 60, max: 300.",
          "default": 60
        },
        "dependencies": {
          "type": "array",
          "description": "Python packages to install before execution. Pre-installed packages (numpy, pandas, scipy, scikit-learn, matplotlib, requests, httpx, beautifulsoup4, pyyaml, toml, python-dateutil, tqdm, pillow) have zero latency. Others are installed via UV/pip (~2-5s). Max 15 packages. Uses --only-binary for security.",
          "maxItems": 15,
          "items": {
            "type": "string",
            "description": "Package name with optional version specifier (e.g., 'pandas', 'numpy>=1.24.0', 'requests==2.31.0')",
            "pattern": "^[a-zA-Z0-9]([a-zA-Z0-9._-]*[a-zA-Z0-9])?(==|>=|<=|~=|!=|<|>)?[0-9]*(\\.[0-9]+)*$"
          }
        },
        "context": {
          "type": "object",
          "description": "Input files for script mode. Keys are filenames, values are file contents. Files written to ./input/ before execution. Mutually exclusive with 'files'.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string",
                "description": "UTF-8 text content"
              },
              {
                "$ref": "#/definitions/ContextFile"
              }
            ]
          }
        }
      }
    },
    "ContextFile": {
      "type": "object",
      "description": "A context file with explicit encoding.",
      "required": ["content", "encoding"],
      "properties": {
        "content": {
          "type": "string",
          "description": "File content (text or base64-encoded binary)"
        },
        "encoding": {
          "type": "string",
          "enum": ["utf-8", "base64"],
          "description": "Content encoding: 'utf-8' for text, 'base64' for binary"
        }
      }
    },
    "RunResponse": {
      "type": "object",
      "required": ["exit_code", "stdout", "stderr", "artifacts"],
      "properties": {
        "exit_code": {
          "type": "integer",
          "format": "int32",
          "description": "Subprocess exit code: 0=success; 124=timeout; 137=OOM; -1=internal error."
        },
        "stdout": {
          "type": "string",
          "description": "Captured standard output."
        },
        "stderr": {
          "type": "string",
          "description": "Captured standard error (and any timeout/internal-error notes)."
        },
        "artifacts": {
          "type": "object",
          "description": "Output files produced by the script. Keys are filenames, values are file contents. Files are read from ./output/ after execution.",
          "additionalProperties": {
            "oneOf": [
              {
                "type": "string",
                "description": "UTF-8 text content (auto-detected)"
              },
              {
                "$ref": "#/definitions/ArtifactFile"
              }
            ]
          }
        }
      }
    },
    "ArtifactFile": {
      "type": "object",
      "description": "A binary artifact file with base64 encoding.",
      "required": ["content", "encoding"],
      "properties": {
        "content": {
          "type": "string",
          "description": "Base64-encoded binary content"
        },
        "encoding": {
          "type": "string",
          "enum": ["base64"],
          "description": "Always 'base64' for binary files"
        }
      }
    },
    "ErrorResponse": {
      "type": "object",
      "required": ["error"],
      "properties": {
        "error": {
          "type": "string",
          "description": "Human-readable error message."
        }
      }
    }
  }
}
